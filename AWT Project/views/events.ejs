<!DOCTYPE html>
<html lang="en">

<%- include('partials/head', { title: 'All Events - CampusConnect' }) %>

    <body>
        <%- include('partials/navbar', { page: 'events' }) %>

            <div style="padding-top: 80px;"></div> <!-- Spacer for fixed nav -->

            <section class="featured-events">
                <div class="section-header">
                    <h2>All Upcoming Events</h2>
                    <% if (user && user.role==='admin' ) { %>
                        <button id="createEventBtn" class="btn-primary" onclick="showCreateEventModal()">+ Create
                            Event</button>
                        <% } %>
                </div>

                <!-- Simple Modal for Create Event -->
                <div id="createEventModal"
                    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; justify-content:center; align-items:center;">
                    <div
                        style="background:var(--card-bg); padding:2rem; border-radius:10px; width:90%; max-width:500px;">
                        <h3 style="margin-bottom:1rem;">Create New Event</h3>
                        <form id="createEventForm">
                            <input type="text" id="evtTitle" placeholder="Title" required
                                style="width:100%; margin-bottom:10px; padding:8px;">
                            <input type="text" id="evtDate" placeholder="Date" required
                                style="width:100%; margin-bottom:10px; padding:8px;">
                            <input type="text" id="evtTime" placeholder="Time" required
                                style="width:100%; margin-bottom:10px; padding:8px;">
                            <input type="text" id="evtLocation" placeholder="Location" required
                                style="width:100%; margin-bottom:10px; padding:8px;">
                            <textarea id="evtDesc" placeholder="Description" required
                                style="width:100%; margin-bottom:10px; padding:8px;"></textarea>
                            <input type="text" id="evtImage" placeholder="Image URL (optional)"
                                style="width:100%; margin-bottom:10px; padding:8px;">
                            <div style="display:flex; gap:10px; justify-content:flex-end;">
                                <button type="button"
                                    onclick="document.getElementById('createEventModal').style.display='none'"
                                    style="padding:8px 16px;">Cancel</button>
                                <button type="submit" class="btn-primary">Create</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="events-grid">
                    <% if (events && events.length> 0) { %>
                        <% events.forEach(event=> { %>
                            <div class="event-card">
                                <img src="<%= event.image %>" alt="<%= event.title %>" class="card-image">
                                <div class="card-content">
                                    <span class="event-date">
                                        <%= event.date %>
                                    </span>
                                    <h3>
                                        <%= event.title %>
                                    </h3>
                                    <div class="event-location">
                                        <span>üìç</span>
                                        <%= event.location %>
                                    </div>
                                    <p class="event-description">
                                        <%= event.description %>
                                    </p>
                                    <% if (user && user.role==='admin' ) { %>
                                        <button onclick="deleteEvent('<%= event._id %>')"
                                            style="background:rgba(239, 68, 68, 0.2); color:#ef4444; border:1px solid #ef4444; padding:5px 15px; border-radius:50px; margin-top:10px; cursor:pointer;">Delete</button>
                                        <% } else if (user) { %>
                                            <button onclick="registerEvent('<%= event._id %>')" class="btn-secondary"
                                                style="margin-top:10px; font-size: 0.9rem; padding: 5px 15px;">Register</button>
                                            <% } else { %>
                                                <a href="/login" class="btn-secondary"
                                                    style="margin-top:10px; font-size: 0.9rem; padding: 5px 15px; display:inline-block;">Login
                                                    to Register</a>
                                                <% } %>
                                </div>
                            </div>
                            <% }); %>
                                <% } else { %>
                                    <p>No upcoming events found.</p>
                                    <% } %>
                </div>
            </section>

            <%- include('partials/footer') %>

                <script src="/js/main.js"></script>
    </body>

</html>